# Predict the airplane seats that are being occupied in the first class of a flight

In this practical exercise, our focus is on utilizing the SAP HANA Machine Learning (ML) algorithm to predict the occupancy of first-class seats on flights using APL Library. 

To execute this exercise, we will leverage the Intelligent Scenario Lifecycle Management (ISLM) framework. ISLM serves as the foundation for creating and managing ML use cases seamlessly within the SAP S/4HANA stack.

This exercise includes the following steps:

1.	**Creating a New Intelligent Scenario**: <br/> We will begin by creating a new intelligent scenario that will encompass the predictive model for first-class seat occupancy.
2.	**Operating the Intelligent Scenario**:<br/> Once the scenario is set up, we will operate it to enable the prediction process.
3.	**Visualizing Model Version Predictions**: <br/> This step involves visualizing the predictions generated by the model versions within the intelligent scenario.

By the end of this exercise, participants will have gained hands-on experience in utilizing the ISLM framework and SAP HANA ML algorithm to enhance decision-making processes and improve customer experiences.


## 1. Create Intelligent Scenario
The Intelligent Scenarios app is used to create intelligent scenarios, review, and publish them, and to make them available in the Intelligent Scenario Management app.

For this use case we will use regression model with Gradient Boosting algorithm. <br>

SAP HANA APL lets you build and apply different types of predictive models, such as classification, regression, and time series forecasting models. Gradient Boosting regression model type provides a more accurate modeling result than the legacy regression model.  


1.	Open the Fiori Launchpad URL
   ```
   https://34.196.182.50:44301/sap/bc/ui5_ui5/ui2/ushell/shells/abap/FioriLaunchpad.html
   ```
   Enter the user details provided by speakers to login.<br>
   Click on **My Home** section and choose the **Intelligent Scenario** app.<br>![](/exercises/ex0/images/1.png)

2. Click the **Create** button and choose **Embedded**.
   In Embedded approach, a business application, for example SAP S/4HANA runs in the same stack as its machine learning provider SAP HANA machine learning with the analytics libraries SAP HANA Automated Predictive Library (APL) or SAP HANA Predictive Analysis Library (PAL).
<br>![](/exercises/ex0/images/2.png)

3. Click on **Do Not Show Again and Close** in the Onboarding Dialog <br>![](/exercises/ex0/images/3.png)
4. Provide the required information in the screen:
	1. **Intelligent Scenario Name**: Enter a unique name starting with Z, such as `Z_SEATOCC_FTCLAS_###` where **###** is your attendee id.
	2. **Intelligent Scenario Description**: Enter a description for the Intelligent Scenario. Intelligent Scenario Type, Algorithm and Machine Learning Library is automatically populated. 
	<br>![](/exercises/ex0/images/4.png)

5. Click on the **Add Model** button.
	<br>![](/exercises/ex0/images/5.png)

 6. The **APL Regression Model** screen will pop up. Provide information as mentioned below:
	1. **Name**: Enter a model name starting with Z.
	2. **Description**: Enter a description.<br>![](/exercises/ex0/images/6.png)
	3. **Training Dataset**: **`ZISLM_SFLIGHT_TRAIN_CDS`**.  Dataset to be used for training the model.
	4. **Apply Dataset**: **`ZISLM_SFLIGHT_APPLY_CDS`**. Dataset to be used for prediction  (Note that apply dataset is 
            different from training dataset).<br>![](/exercises/ex0/images/7.png)
	5. **Target**: `SEATSOCCF`. Field whose value you want to predict.
	6. **Max Reason Code**: `1`. Number of reason codes you want to generate.<br>
           Reason codes are variables whose values have the most influence in a score-based 
            decision (typically a risk score). The variables for which the contribution is 
            the most differential are selected as the most important reason codes. <br>
Apply output configuration has the selected metrics that are added in the intelligent scenario output and used for prediction.    
 Click on the **Add** button.<br>![](/exercises/ex0/images/8.png)
7. The scenario is now created in Draft Status. View the Input and Output fields to train the model in the **Input and 
   Outputs Tabs** respectively.<br>

   Input Tab displays the key, input, and target fields. 
   The Input variable is considered for modelling. The Key variable is a key field of the dataset and is also considered 
   for modelling. The Target variable is the variable whose values are to be modelled and predicted by other variables.
   <br>
   
   Output tab displays the Key, Target, and Prediction fields. 
The Prediction variable includes the calculation result.
<br>![](/exercises/ex0/images/9.png)

9. Scenario is now ready to be published. Click on **Publish** button. You will receive a message that Intelligent Scenario is published.<br>![](/exercises/ex0/images/10.png)
10. Search the Intelligent Scenario created by you by entering the **Intelligent Scenario name and Status = Published**.
    <br>![](/exercises/ex0/images/11.png)
11. Navigate to the details page by clicking the `>` icon.  <br>![](/exercises/ex0/images/12.png)
12. Click on **Apply Setting** Tab and copy the CDS View name.
CDS views are generated for the intelligent scenario to allow easy access to the predictions
<br>![](/exercises/ex0/images/13.png)

### Well done, you just created your first Intelligent Scenario.
<br>

## 2. Operating the Intelligent Scenario
Once the Intelligent Scenario is published, the Intelligent Scenario Management app helps you to train, monitor the model quality and activate the model for productive usage.
In this section, you will use the Intelligent Scenario Management app to perform ML operations. 

1. Open the Fiori Launchpad URL
   ```
   https://34.196.182.50:44301/sap/bc/ui5_ui5/ui2/ushell/shells/abap/FioriLaunchpad.html
   ```
   Enter the user details provided by speakers to login.<br>
   Click on **My Home** section and choose the **Intelligent Scenario Management** app
   <br>![](/exercises/ex0/images/14.png)

2. Search the **First-Class Seats Occupied** scenario created by you and navigate to the details page by clicking the `>` icon.
   <br>![](/exercises/ex0/images/15.png)

3. Select the Model and click on the **Train button** to trigger the training.
   <br>![](/exercises/ex0/images/16.png)
4. In the Model section, view the Dataset Record Count. Click on **Train** button.
   <br>![](/exercises/ex0/images/17.png)
5. New Model Version will be created in **Scheduled** status.
   <br>![](/exercises/ex0/images/18.png)
6. Monitor the status of the **Model Version** and check the status changes to **Training**.
   <br>![](/exercises/ex0/images/19.png)
7. Monitor the status of the Model Version and check the status changes to **Ready**.
   <br>![](/exercises/ex0/images/20.png)
8. Click on '**>**' icon to view Model Version Report.
   <br>![](/exercises/ex0/images/21.png)
9. View different tabs like **Quality Information and Debrief**. You can see attributes about data quality and what key influencers 
   are affecting the predictions.
   <br>![](/exercises/ex0/images/22.png)
    <br>Choose the back icon <h1>`<`</h1>  to navigate back to Model Versions screen.
10. Activate the model version to return predictions. Select the Model Version and click the **Activate** button.
    <br>![](/exercises/ex0/images/23.png)

   
### Well done, you just Operated the Intelligent Scenario by training your first model.
<br>

## 3. Visualizing Model Version Predictions

In this step, you will use the ABAP GUI tool to view the model's predictions.Open SAP Logon and logon to system **HE4** using the user and password provided by the moderator.  

1. Open transaction **/nSE38**
   <br>![](/exercises/ex0/images/24.png)

2. Search for report **RUT_DDLS_DATA_PREVIEW** and click on Execute 
   <br>![](/exercises/ex0/images/25.png)

3. Enter the ISLM generated CDS view of created Intelligent Scenario to view predictions from trained model. This CDS View was copied in the first step during creation of the Intelligent Scenario. 
   **CDS View will have following name <INTELLIGENT_SCENARIO_NAME>_CDS01.** 
   Enter CDS View Name in Entity Name field and click on **Execute**.
   <br>![](/exercises/ex0/images/26.png)

4. You can scroll down and see the model's keys in the first four columns: **Airline Code, Flight Connection Number, Flight Date and Booking number.**
Column **SEATSOCC_F** has the actual value of the seats occupied.
The column **GB_SCORE_SEATSOCC_F** column has the predicted value of the occupied seats. 
<br>![](/exercises/ex0/images/27.png)

 ### Well done, you just visualized your trained model predictions..!
<br>

## Summary
ðŸŽ‰ Congratulations! ðŸŽ‰
<br>
 You have successfully completed the Exercise 1. <br>
Now Continue to - [Exercise 2 - Predict the plane type of an aircraft](../ex1/README.md)
